import { DiagnosisScore, AnswerMap } from './diagnosis';
import { QUESTIONS } from './questions';

// ã‚¿ã‚¤ãƒ—å®šç¾©ãƒ‡ãƒ¼ã‚¿
export const DIAGNOSIS_TYPES = {
  reimei: {
    name: 'ğŸŒ„ é»æ˜ï¼ˆã‚Œã„ã‚ã„ï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«ã‚ãµã‚ŒãŸäººã§ã™ã€‚æ€ã„ã¤ã„ãŸã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ã€Œå½¢ã€ã«ã—ã€å‘¨å›²ã‚’å·»ãè¾¼ã¿ãªãŒã‚‰å‰ã«é€²ã‚ã¾ã™ã€‚å¤‰åŒ–ã‚’æ€–ãŒã‚‹ã‚ˆã‚Šã€ã‚€ã—ã‚æ¥½ã—ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚å‘¨å›²ã‹ã‚‰ã¯ã€Œè¡Œå‹•åŠ›ãŒã‚ã‚‹ã€ã€Œåˆºæ¿€çš„ã€ã¨è¦‹ã‚‰ã‚Œã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚ãŸã ã—ã€å‹¢ã„ãŒå…ˆè¡Œã—ã™ãã‚‹ã¨ç–²ã‚Œã‚„ã™ã„ã®ã§ã€ä¼‘æ¯ã‚‚å¤§åˆ‡ã§ã™ã€‚',
  },
  choai: {
    name: 'ğŸŒ… æœé„ï¼ˆã¡ã‚‡ã†ã‚ã„ï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€é™ã‹ã«æ·±ãè€ƒãˆã‚‹ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼æ°—è³ªã€‚ä¸€äººã®æ™‚é–“ã‹ã‚‰è±Šã‹ãªç™ºæƒ³ãŒç”Ÿã¾ã‚Œã¾ã™ã€‚å¤§å‹¢ã®å ´ã‚ˆã‚Šã‚‚ã€è½ã¡ç€ã„ãŸç’°å¢ƒã§åŠ›ã‚’ç™ºæ®ã—ã¾ã™ã€‚ã€Œç‹¬ç‰¹ã®æ„Ÿæ€§ãŒã‚ã‚‹ã€ã¨è¨€ã‚ã‚Œã‚‹ã“ã¨ã‚‚ã€‚ç™ºä¿¡ã‚’ãŸã‚ã‚‰ã„ã™ããšã€å¤–ã«å‡ºã™å‹‡æ°—ãŒéµã«ãªã‚Šã¾ã™ã€‚',
  },
  asanagi: {
    name: 'ğŸŒ æœå‡ªï¼ˆã‚ã•ãªãï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€ç©ã‚„ã‹ã§è‡ªç„¶ä½“ãªãƒãƒ©ãƒ³ã‚¹å‹ã€‚æ¥µç«¯ã«åã‚‰ãšã€çŠ¶æ³ã«åˆã‚ã›ã¦æŸ”è»Ÿã«å‹•ã‘ã¾ã™ã€‚æ´¾æ‰‹ã•ã¯ãªãã¦ã‚‚ã€å®‰å®šæ„ŸãŒã‚ã‚Šã¾ã™ã€‚ã©ã‚“ãªç’°å¢ƒã§ã‚‚å¤§ããå´©ã‚Œã«ãã„ã‚¿ã‚¤ãƒ—ã€‚è‡ªåˆ†ã®è»¸ã‚’æ„è­˜ã™ã‚‹ã¨ã€ã•ã‚‰ã«å­˜åœ¨æ„ŸãŒå¢—ã—ã¾ã™ã€‚',
  },
  reijitsu: {
    name: 'â˜€ï¸ éº—æ—¥ï¼ˆã‚Œã„ã˜ã¤ï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€ç†æƒ³ã‚’ç¾å®Ÿã«å¤‰ãˆã‚‹äººã€‚æ€ã„ã¤ãã§çµ‚ã‚ã‚‰ã›ãšã€ã¡ã‚ƒã‚“ã¨è¨ˆç”»ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚å‘¨å›²ã‹ã‚‰ã¯ã€Œé ¼ã‚Œã‚‹ã€ã€Œé ­ãŒåˆ‡ã‚Œã‚‹ã€ã¨æ€ã‚ã‚Œã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚å¤¢ã¨ç¾å®Ÿã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚ŒãŸã‚¿ã‚¤ãƒ—ã§ã™ã€‚å®Œç’§ã‚’æ±‚ã‚ã™ãã‚‹ã¨è‡ªåˆ†ã‚’è¿½ã„è¾¼ã¿ã‚„ã™ã„ã®ã§æ³¨æ„ã€‚',
  },
  shunyo: {
    name: 'ğŸŒ¤ æ˜¥é™½ï¼ˆã—ã‚…ã‚“ã‚ˆã†ï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€è‡ªç”±ã§å¥½å¥‡å¿ƒã„ã£ã±ã„ã®äººã€‚é¢ç™½ãã†ã¨æ€ã£ãŸã‚‰ã€ã¾ãšè©¦ã—ã¦ã¿ãŸããªã‚Šã¾ã™ã€‚å‹ã«ã¯ã¾ã‚‰ãªã„ç™ºæƒ³ãŒé­…åŠ›ã§ã™ã€‚ãŸã ã€èˆˆå‘³ãŒç§»ã‚Šã‚„ã™ãã€é€”ä¸­ã§é£½ãã¦ã—ã¾ã†ã“ã¨ã‚‚ã€‚ã€Œç¶šã‘ã‚‹å·¥å¤«ã€ãŒã§ãã‚‹ã¨æ‰èƒ½ãŒã•ã‚‰ã«é–‹ãã¾ã™ã€‚',
  },
  hakuchu: {
    name: 'ğŸŒ ç™½æ˜¼ï¼ˆã¯ãã¡ã‚…ã†ï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€å®Ÿè¡ŒåŠ›ã®ã‹ãŸã¾ã‚Šã€‚ç›®æ¨™ã‚’æ±ºã‚ãŸã‚‰ä¸€ç›´ç·šã«é€²ã¿ã¾ã™ã€‚å‘¨å›²ã‹ã‚‰ã¯ã€Œé ¼ã‚Œã‚‹ãƒªãƒ¼ãƒ€ãƒ¼ã€ã¨è¦‹ã‚‰ã‚Œã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚å¿™ã—ã„çŠ¶æ³ã§ã‚‚å‹•ã˜ã«ãã„å¼·ã•ãŒã‚ã‚Šã¾ã™ã€‚é ‘å¼µã‚Šã™ãã¦ç„¡ç†ã‚’ã—ãªã„ã‚ˆã†ã«æ°—ã‚’ã¤ã‘ã¦ã€‚',
  },
  sekishu: {
    name: 'ğŸŒˆ å¤•é©Ÿï¼ˆã›ãã—ã‚…ã†ï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€å ´ã‚’æ˜ã‚‹ãã™ã‚‹ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚äººã¨é–¢ã‚ã‚‹ã“ã¨ã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒé«˜ã¾ã‚Šã¾ã™ã€‚ãƒãƒªã‚„ç›´æ„Ÿã§å‹•ãã“ã¨ãŒå¤šã„ã‚¿ã‚¤ãƒ—ã§ã™ã€‚å‘¨å›²ã‹ã‚‰ã¯ã€Œä¸€ç·’ã«ã„ã‚‹ã¨æ¥½ã—ã„ã€ã¨æ€ã‚ã‚ŒãŒã¡ã€‚ãŸã ã—ã€å‹¢ã„ä»»ã›ã§å¾Œå›ã—ãŒå¢—ãˆãªã„ã‚ˆã†ã«æ³¨æ„ã€‚',
  },
  gorei: {
    name: 'ğŸŒ» åˆéº—ï¼ˆã”ã‚Œã„ï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€ã‚ãŸãŸã‹ãç¤¾äº¤çš„ãªäººã€‚äººã¨äººã‚’ã¤ãªãã®ãŒå¾—æ„ã§ã™ã€‚ãƒãƒ¼ãƒ ã®ä¸­ã§è‡ªç„¶ã¨èª¿æ•´å½¹ã«ãªã‚Šã¾ã™ã€‚å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã‚‹å­˜åœ¨ã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚ç›¸æ‰‹ã«åˆã‚ã›ã™ãã¦ã€è‡ªåˆ†ã‚’å¾Œå›ã—ã«ã—ãªã„ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚',
  },
  sekki: {
    name: 'ğŸŒ¾ å¤•æš‰ï¼ˆã›ã£ãï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€ç©ã‚„ã‹ã§æ€ã„ã‚„ã‚Šæ·±ã„èãæ‰‹ã€‚äººã®æ°—æŒã¡ã‚’ä¸å¯§ã«å—ã‘æ­¢ã‚ã¾ã™ã€‚ç›®ç«‹ãŸãªãã¦ã‚‚ã€å‘¨å›²ã‹ã‚‰ä¿¡é ¼ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸€å¯¾ä¸€ã®é–¢ä¿‚ã§ç‰¹ã«åŠ›ã‚’ç™ºæ®ã—ã¾ã™ã€‚è‡ªåˆ†ã®æœ¬éŸ³ã‚’æºœã‚è¾¼ã¿ã™ããªã„ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚',
  },
  yunagi: {
    name: 'ğŸŒŠ å¤•å‡ªï¼ˆã‚†ã†ãªãï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€å®‰å®šæ„Ÿã®ã‚ã‚‹ä¿¡é ¼å‹ã€‚ç´„æŸã‚’å®ˆã‚Šã€è²¬ä»»ã‚’æœãŸã—ã¾ã™ã€‚å‘¨å›²ã‹ã‚‰ã¯ã€Œå®‰å¿ƒã—ã¦ä»»ã›ã‚‰ã‚Œã‚‹äººã€ã¨æ€ã‚ã‚Œã¾ã™ã€‚æ´¾æ‰‹ã•ã‚ˆã‚Šã‚‚å …å®Ÿã•ãŒå¼·ã¿ã§ã™ã€‚æŸ”è»Ÿã•ã‚’æ„è­˜ã™ã‚‹ã¨ã€ã•ã‚‰ã«é­…åŠ›ãŒåºƒãŒã‚Šã¾ã™ã€‚',
  },
  yoiyami: {
    name: 'ğŸŒ† å®µé—‡ï¼ˆã‚ˆã„ã‚„ã¿ï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€æ„Ÿå—æ€§ãŒè±Šã‹ã§ç¹Šç´°ãªäººã€‚ç¾ã—ã„ã‚‚ã®ã‚„ç‰©èªã«å¿ƒãŒå¼·ãå‹•ãã¾ã™ã€‚æ„Ÿæƒ…ã®æ³¢ã‚‚å¤§ãã‚ã§ã™ãŒã€ãã‚ŒãŒæ·±ã¿ã«ãªã‚Šã¾ã™ã€‚èŠ¸è¡“çš„ãƒ»è¡¨ç¾çš„ãªæ‰èƒ½ãŒçœ ã£ã¦ã„ã‚‹å¯èƒ½æ€§ã‚‚ã€‚ç–²ã‚Œã‚„ã™ã„ã®ã§ã€å®‰å¿ƒã§ãã‚‹ç’°å¢ƒãŒé‡è¦ã§ã™ã€‚',
  },
  ushimitsu: {
    name: 'ğŸŒ™ ä¸‘ä¸‰ã¤æ™‚ï¼ˆã†ã—ã¿ã¤ã©ãï¼‰ã‚¿ã‚¤ãƒ—',
    description: 'ã‚ãªãŸã¯ã€æ…é‡ã§è²¬ä»»æ„ŸãŒå¼·ã„äººã€‚ä¸å®‰ã‚’æ„Ÿã˜ã‚„ã™ã„åˆ†ã€æº–å‚™ã‚’æ€ ã‚Šã¾ã›ã‚“ã€‚ã€Œãã¡ã‚“ã¨ã—ã¦ã„ã‚‹ã€ã¨è©•ä¾¡ã•ã‚Œã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚å•é¡Œã‚’äº‹å‰ã«å¯ŸçŸ¥ã§ãã‚‹åŠ›ãŒã‚ã‚Šã¾ã™ã€‚è‡ªåˆ†ã«å³ã—ããªã‚Šã™ããªã„ã“ã¨ãŒãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚',
  },
};

export const calculateScore = (answers: AnswerMap): DiagnosisScore => {
  const score: DiagnosisScore = { E: 0, A: 0, C: 0, N: 0, O: 0 };
  const counts: Record<string, number> = { E: 0, A: 0, C: 0, N: 0, O: 0 };

  QUESTIONS.forEach((q) => {
    const val = answers[q.id] || 3; // æœªå›ç­”ã¯3(ã©ã¡ã‚‰ã¨ã‚‚ã„ãˆãªã„)æ‰±ã„
    score[q.factor] += val;
    counts[q.factor]++;
  });

  // å¹³å‡åŒ– (1.0 - 5.0)
  (Object.keys(score) as (keyof DiagnosisScore)[]).forEach((key) => {
    score[key] = parseFloat((score[key] / counts[key]).toFixed(2));
  });

  return score;
};

export const determineType = (score: DiagnosisScore) => {
  const factors = Object.entries(score).map(([k, v]) => ({ factor: k, value: v }));
  
  // æœå‡ªãƒã‚§ãƒƒã‚¯: å…¨å› å­ãŒ 2.7ä»¥ä¸Š 3.7æœªæº€
  const isAllMiddle = factors.every(f => f.value >= 2.7 && f.value < 3.7);
  if (isAllMiddle) return DIAGNOSIS_TYPES.asanagi;

  // ã‚½ãƒ¼ãƒˆ (é™é †)
  factors.sort((a, b) => b.value - a.value);
  const first = factors[0];
  const second = factors[1];

  // åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
  // 1ä½ãŒO
  if (first.factor === 'O') {
    if (score.E < 2.7) return DIAGNOSIS_TYPES.choai; // æœé„ (Oé«˜ Eä½)
    if (score.C < 2.7) return DIAGNOSIS_TYPES.shunyo; // æ˜¥é™½ (Oé«˜ Cä½)
    if (second.factor === 'C') return DIAGNOSIS_TYPES.reijitsu; // éº—æ—¥ (Oé«˜ Cé«˜)
    if (second.factor === 'N') return DIAGNOSIS_TYPES.yoiyami; // å®µé—‡ (Né«˜ Oé«˜)
    return DIAGNOSIS_TYPES.reimei; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: é»æ˜ (Oé«˜ Eé«˜ãªã©)
  }

  // 1ä½ãŒE
  if (first.factor === 'E') {
    if (score.C < 2.7) return DIAGNOSIS_TYPES.sekishu; // å¤•é©Ÿ (Eé«˜ Cä½)
    if (second.factor === 'A') return DIAGNOSIS_TYPES.gorei; // åˆéº— (Aé«˜ Eé«˜)
    if (second.factor === 'O') return DIAGNOSIS_TYPES.reimei; // é»æ˜ (Oé«˜ Eé«˜)
    return DIAGNOSIS_TYPES.hakuchu; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ç™½æ˜¼ (Eé«˜ Cé«˜ãªã©)
  }

  // 1ä½ãŒA
  if (first.factor === 'A') {
    if (score.E < 2.7) return DIAGNOSIS_TYPES.sekki; // å¤•æš‰ (Aé«˜ Eä½)
    if (second.factor === 'C') return DIAGNOSIS_TYPES.yunagi; // å¤•å‡ª (Cé«˜ Aé«˜)
    if (second.factor === 'E') return DIAGNOSIS_TYPES.gorei; // åˆéº— (Aé«˜ Eé«˜)
    return DIAGNOSIS_TYPES.gorei; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  }

  // 1ä½ãŒC
  if (first.factor === 'C') {
    if (second.factor === 'A') return DIAGNOSIS_TYPES.yunagi; // å¤•å‡ª (Cé«˜ Aé«˜)
    if (second.factor === 'O') return DIAGNOSIS_TYPES.reijitsu; // éº—æ—¥ (Oé«˜ Cé«˜)
    if (second.factor === 'N') return DIAGNOSIS_TYPES.ushimitsu; // ä¸‘ä¸‰ã¤æ™‚ (Né«˜ Cé«˜)
    return DIAGNOSIS_TYPES.hakuchu; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ç™½æ˜¼ (Eé«˜ Cé«˜)
  }

  // 1ä½ãŒN
  if (first.factor === 'N') {
    if (second.factor === 'O') return DIAGNOSIS_TYPES.yoiyami; // å®µé—‡ (Né«˜ Oé«˜)
    return DIAGNOSIS_TYPES.ushimitsu; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ä¸‘ä¸‰ã¤æ™‚ (Né«˜ Cé«˜)
  }

  return DIAGNOSIS_TYPES.asanagi; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
};